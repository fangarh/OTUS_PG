# Домашняя работа №4

# Подготовка
*Для выполнения домашней работы было разрешено использовать более позднии версии postgres* <br>


# Основная работа

> создайте новый кластер PostgresSQL 14 <br>
> зайдите в созданный кластер под пользователем postgres <br>
> создайте новую базу данных testdb <br>
> зайдите в созданную базу данных под пользователем postgres <br>
> создайте новую схему testnm <br>
> создайте новую таблицу t1 с одной колонкой c1 типа integer <br>
> вставьте строку со значением c1=1 <br>

На нашем кластере отсутствуют стороннии БД. Кластер не имел каких-либо доп настроек, кроме доступа наружу.

![имг 00](IMG/0_0.png "Подготовка")

Выполняем подготовительные шаги.

![имг 01](IMG/0_1.png "Подготовка")

> создайте новую роль readonly<br>
> дайте новой роли право на подключение к базе данных testdb<br>
> дайте новой роли право на использование схемы testnm<br>
> дайте новой роли право на select для всех таблиц схемы testnm<br>
> создайте пользователя testread с паролем test123<br>
> дайте роль readonly пользователю testread<br>

Создали необходимые роли

![имг 1](IMG/1.png "Подготовка")

> зайдите под пользователем testread в базу данных testdb<br>
> сделайте select * from t1;<br>
> получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)<br>
> напишите что именно произошло в тексте домашнего задания<br>
> у вас есть идеи почему? ведь права то дали? <br>
> посмотрите на список таблиц<br>
> подсказка в шпаргалке под пунктом 20<br>
> а почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)<br>


Выполнили попытку чтения. 

![имг 2](IMG/2.png "Подготовка")

Прав на чтение нет, в связи с тем что, пользователь testread имеет права на SELECT только в схеме testnm.<br>
Пользователь так-же не явно через public получил возможность просмотра содержащихся в схеме public таблиц, <br>
по этому ошибка нет доступа на чтение, а не объект не найден.<br>


>> (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже) 
>> при определенных настройках search_path таблица при создании могла получить схему не public, а testnm 

>> посмотрите на список таблиц<br>
>> см. рис подготовки<br>

> вернитесь в базу данных testdb под пользователем postgres<br>
> удалите таблицу t1<br>
> создайте ее заново но уже с явным указанием имени схемы testnm<br>
> вставьте строку со значением c1=1<br>

![имг 00](IMG/3.png "Подготовка")

> зайдите под пользователем testread в базу данных testdb
> <br>сделайте select * from testnm.t1;
> <br>получилось?
> <br>есть идеи почему? если нет - смотрите шпаргалку
> <br>как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку
> <br>сделайте select * from testnm.t1;
> <br>получилось?
> <br>есть идеи почему? если нет - смотрите шпаргалку
> <br>сделайте select * from testnm.t1;
> <br>получилось?
> <br>ура!

Выполняем select

![имг 00](IMG/4.png "Подготовка")

Прав на чтение нет

>> <br>есть идеи почему? если нет - смотрите шпаргалку

Когда выдаются права на схему, PG проходит по всем объектам внутри и раздает права.
До удаления таблицы мы могли таким образом посмотреть содержимое.

>> <br>как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку

Либо повторно выдать права на схему, либо конкретно на таблицу

![имг 00](IMG/5.png "Подготовка")

после чего чтение прошло успешно, так как права заного выданы.

![имг 00](IMG/6.png "Подготовка")

> <br> теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);
> <br> а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?
> <br> есть идеи как убрать эти права? если нет - смотрите шпаргалку
> <br> если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что 
  <br>   сделали и почему выполнив указанные в ней команды



> <br> теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);
> <br> расскажите что получилось и почему 





# Задача со звёздочкой
404 - Not found