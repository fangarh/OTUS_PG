# Домашняя работа №7
### Тема "Журналы PostgreSQL"


>    Настройте выполнение контрольной точки раз в 30 секунд.<br>

![имг00](IMG/0.png "шаг 1")

>    10 минут c помощью утилиты pgbench подавайте нагрузку.<br>

![имг01](IMG/1.png "шаг 2")

>    Измерьте, какой объем журнальных файлов был сгенерирован за это время. <br>

![имг02](IMG/2.png "шаг 3")

* Оцените, какой объем приходится в среднем на одну контрольную точку.<br>
 
 64mb/10/0.5  = 3.2mb дискового пространства за контрольную точку

>    Проверьте данные статистики: все ли контрольные точки выполнялись точно по расписанию. Почему так произошло?<br>

![имг03](IMG/3.png "шаг 4")<br>

По данным статистики 26 контрольных точек. Данный результат (отличае от 20) связан с достаточно большим промежутком (~ 2-4 мин)<br>
 между окончанием работы pgbanchи выполнением запроса на статистику. Ниже приведен результат c маленькой задержкой.<br>
![имг04](IMG/4.png "шаг 5")

>    Сравните tps в синхронном/асинхронном режиме утилитой pgbench. Объясните полученный результат.<br>
* Синхронный <br>
![имг04](IMG/5_1.png "шаг 6")

* Асинхронный режим, работа выполняется в асинхронном режиме, нет ожидания локального сброса WAL на диск.<br>
![имг04](IMG/5_2.png "шаг 6")

* Количество tps увеличилось. Но возможны потери последних транзакций при сбое сервера.

>    Создайте новый кластер с включенной контрольной суммой страниц. Создайте таблицу. Вставьте несколько значений. Выключите кластер.<br> 

![имг04](IMG/6.png "шаг 7")

>    Измените пару байт в таблице. Включите кластер и сделайте выборку из таблицы. Что и почему произошло? как проигнорировать ошибку и продолжить работу?<br>

![имг04](IMG/7.png "шаг 8")

* Т.к. включен контроль контрольной суммы, выходит ошибка и не дает закончить транзакцию. 
<br>Включу игнор ошибки контрольной суммы (**ALTER SYSTEM SET ignore_checksum_failure=on;**), в этом случае, 
<br>если заголовок блока не поврежден, будет можно получить неповрежденные данные таблицы, 
<br>будет выдаваться предупреждение о нарушении целостности, но транзакция будет выполняться. 
<br>Если же повреждён заголовок, будет выдана ошибка, даже когда этот параметр включён.


![имг04](IMG/8.png "шаг 8")